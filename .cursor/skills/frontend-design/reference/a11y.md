# Accessibility (a11y)

## Start Here: The Semantic HTML Contract

Accessibility starts before ARIA, before testing tools, before anything else. Use the right HTML element and you get keyboard support, screen reader semantics, and browser-native behavior for free.

| You want | Use | Not |
|----------|-----|-----|
| A button that does something | `<button>` | `<div onclick>` |
| A link to a URL | `<a href>` | `<button>` |
| A navigable list | `<nav><ul><li>` | `<div><div><span>` |
| A page region | `<main>`, `<header>`, `<footer>`, `<aside>` | `<div id="main">` |
| A group with a label | `<fieldset><legend>` or `<section aria-labelledby>` | unlabeled `<div>` |
| Tabular data | `<table>` with `<th scope>` | CSS grid that looks like a table |

**The ARIA rule**: ARIA is a corrective tool, not a styling tool. If you're using `role="button"` on a `<div>`, stop and use `<button>`. First rule of ARIA: don't use ARIA if native HTML will do it.

## ARIA Done Right

When you genuinely need ARIA (custom widgets, dynamic content), these are the patterns worth knowing:

### States and Properties

```html
<!-- Expanded/collapsed -->
<button aria-expanded="false" aria-controls="menu">Options</button>
<ul id="menu" hidden>...</ul>

<!-- Required fields — don't rely on placeholder or asterisk alone -->
<input aria-required="true" />

<!-- Invalid state — pair with error message -->
<input aria-invalid="true" aria-describedby="email-error" />
<p id="email-error">Email must include an @ symbol.</p>

<!-- Current page in nav -->
<a href="/about" aria-current="page">About</a>

<!-- Busy/loading -->
<div aria-live="polite" aria-busy="true">Loading results...</div>
```

### When to Use Which Live Region

Live regions announce dynamic changes to screen readers. Overuse causes announcement fatigue.

| Urgency | Use | When |
|---------|-----|------|
| **Polite** | `aria-live="polite"` | Status updates, search results, async content — waits for user to finish |
| **Assertive** | `aria-live="assertive"` | Errors that block progress — interrupts immediately |
| **Status role** | `role="status"` | Short confirmations ("Saved", "Copied") |
| **Alert role** | `role="alert"` | Implies `aria-live="assertive"` — use sparingly |

```html
<!-- Toast confirmations -->
<div role="status" aria-live="polite" class="toast">
  Changes saved.
</div>

<!-- Form submission error -->
<div role="alert">
  Your session expired. Please sign in again.
</div>
```

**The injection trick**: Live regions must exist in the DOM before content is injected. Injecting the entire element won't trigger announcement — only changing content inside a pre-existing live region will.

## Focus Management

Browsers handle focus for native controls, but SPAs and custom widgets break the model. You need to manage it manually.

### When to Move Focus

| Situation | Move focus to |
|-----------|---------------|
| Modal opens | First focusable element inside modal |
| Modal closes | The element that triggered it |
| Page navigation (SPA) | Page `<h1>` or `<main>` |
| Inline error appears | The error message, or the invalid field |
| Content expands (accordion) | Nothing — content follows the trigger naturally |
| Toast appears | Never — use a live region instead |

```javascript
// SPA route change: move focus to main heading
router.afterEach(() => {
  nextTick(() => {
    const heading = document.querySelector('h1');
    heading?.focus();
  });
});

// Return focus when modal closes
const trigger = document.activeElement; // save before opening
modal.close();
trigger.focus();
```

**Note**: Elements need `tabindex="-1"` to receive programmatic focus if they're not natively focusable:

```html
<h1 tabindex="-1">Page Title</h1>
```

This allows `focus()` calls without adding the element to the tab order.

See interaction-design.md for focus ring CSS and the `inert` approach to modal trapping.

## Keyboard Patterns by Widget Type

Not everything follows the same keyboard model. Get this wrong and keyboard users are stuck.

| Widget | Tab behavior | Arrow behavior |
|--------|-------------|----------------|
| **Button, link, input** | Focusable | N/A |
| **Tabs** | One tab stop total | Left/Right moves between tabs |
| **Radio group** | One tab stop total | Up/Down selects and moves |
| **Menu/dropdown** | Opens on Enter/Space | Up/Down navigates, Escape closes |
| **Dialog** | Focus trapped inside | N/A |
| **Listbox** | One tab stop | Up/Down moves, Enter selects |
| **Tree** | One tab stop | Up/Down navigates, Right expands, Left collapses |
| **Data grid** | One tab stop | All arrow keys navigate cells |

The full pattern specs live at [aria-practices.org](https://www.w3.org/WAI/ARIA/apg/patterns/). When in doubt, check there before inventing your own pattern.

## Accessible Forms

**Labels are not optional.** `placeholder` disappears and provides zero context to screen readers by default.

```html
<!-- Correct: explicit label association -->
<label for="email">Email address</label>
<input type="email" id="email" name="email" />

<!-- Also correct: implicit wrapping -->
<label>
  Email address
  <input type="email" name="email" />
</label>

<!-- Hidden but accessible label (use sparingly) -->
<label for="search" class="sr-only">Search</label>
<input type="search" id="search" />
```

**Grouping related fields:**
```html
<fieldset>
  <legend>Shipping address</legend>
  <!-- fields here inherit the group label -->
</fieldset>
```

**Error association:** See ux-writing.md for error message content. For the HTML wiring:

```html
<label for="dob">Date of birth</label>
<input
  id="dob"
  type="text"
  aria-invalid="true"
  aria-describedby="dob-hint dob-error"
/>
<p id="dob-hint">Format: MM/DD/YYYY</p>
<p id="dob-error" role="alert">Please enter a valid date.</p>
```

`aria-describedby` chains multiple IDs—hints and errors can coexist.

## Images and Media

### Alt Text

The alt text question is: *what information does this image convey?*

```html
<!-- Informative image: describe the information, not the appearance -->
<img src="chart.png" alt="Revenue grew 40% YoY, from $2M to $2.8M in Q4 2024">

<!-- Decorative: empty alt, no role -->
<img src="divider.svg" alt="">

<!-- Functional (linked/button): describe the destination or action -->
<a href="/home"><img src="logo.svg" alt="Acme Corp — Home"></a>

<!-- Complex diagram: brief alt + long description -->
<img src="architecture.png" alt="System architecture diagram" aria-describedby="arch-desc">
<p id="arch-desc" class="sr-only">Three-tier architecture: React frontend connects to...</p>
```

### Video and Audio

- Captions for all video with speech (auto-captions are a start, not a finish — edit them)
- Audio descriptions for visual-only content
- Transcripts for podcasts and audio content
- Never autoplay with sound

## Screen Reader Utilities

The screen reader only class is load-bearing infrastructure — define it once, use it everywhere:

```css
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}
```

Common uses: labeling icon buttons, adding context to ambiguous controls, providing skip link targets, describing chart data.

```html
<!-- Icon button: visual icon + hidden label -->
<button aria-label="Close dialog">
  <svg aria-hidden="true" focusable="false">...</svg>
</button>

<!-- Ambiguous table data -->
<td>
  <span aria-hidden="true">★★★☆☆</span>
  <span class="sr-only">3 out of 5 stars</span>
</td>
```

**Note `aria-hidden="true"` on SVGs and decorative icons**: removes them from the accessibility tree entirely. Without this, screen readers will attempt to announce them — usually as a stream of path data.

## Testing

Don't ship untested. These four methods cover most of what you'll find:

**1. Keyboard-only navigation**
Unplug your mouse. Tab through every interactive element. Check: can you reach it? Can you use it? Is focus always visible? Does focus ever disappear into a black hole?

**2. Screen reader smoke test**
Use what's available:
- macOS/iOS: VoiceOver (`Cmd+F5`)
- Windows: NVDA (free) or Narrator
- Android: TalkBack

Read through a page. Listen for: unlabeled buttons ("button" with no context), repeated or meaningless link text, content that's announced twice, missing form labels.

**3. Automated scanning**
axe DevTools (browser extension) catches ~30-40% of issues automatically. Run it on every major view. Zero violations is the baseline, not the goal.

**4. Zoom to 200%**
Set browser zoom to 200%. Nothing should overflow, truncate, or overlap. See typography.md for the `user-scalable=no` anti-pattern.

### WCAG at a Glance

Most teams target **AA**. AAA is aspirational for specific content types (legal, medical, government).

| Criterion | AA | AAA |
|-----------|-----|-----|
| Text contrast | 4.5:1 | 7:1 |
| Large text contrast | 3:1 | 4.5:1 |
| UI component contrast | 3:1 | — |
| Keyboard accessible | Required | — |
| No keyboard traps | Required | — |
| Focus visible | Required | Enhanced |
| Images of text | Avoid | Strict avoid |
| Captions (live) | AA | — |

Full contrast requirements are in color-and-contrast.md.

## The `prefers-reduced-motion` Overlap

Vestibular disorders are an accessibility concern, not just a UX preference. If you're skipping `prefers-reduced-motion` support, you're failing WCAG 2.3.3 (AAA) and creating genuine physical discomfort for some users. See motion-design.md for implementation.

---

**Avoid**: Using `<div>` and `<span>` for interactive elements. ARIA as a first resort instead of semantic HTML. Live regions that announce too frequently. Removing focus styles without replacement. Placeholder-only form labels. Empty or missing alt text. Testing only with automated tools.